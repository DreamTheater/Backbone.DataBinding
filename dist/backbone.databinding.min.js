/**
 * Backbone.DataBinding v0.2.9
 * https://github.com/DreamTheater/Backbone.DataBinding
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
!function(){"use strict";function a(a){return _.isBoolean(a)?a:!_.isNull(a)&&!_.isUndefined(a)}var b=Backbone.View;Backbone.ViewModel=b.extend({constructor:function(a){this.bindings={},this.initialize=_.wrap(this.initialize,function(a,b){return a.call(this,b)}),b.call(this,a)},setElement:_.wrap(b.prototype.setElement,function(a,b,c){return this.$el&&this.undelegateBindings(),a.call(this,b,c),c!==!1&&this.delegateBindings(),this}),binding:function(a,b,c,d){var e=b.match(/^(\S+):(\S+)$/),f=e[1],g=e[2];return c&&(this.bindings[a?c+" "+a:c]=_.bind(function(){var b=this.constructor.readers[f],c=a?this.$(a):this.$el,e=b?b.call(this,c):c.prop(f);this.model.set(g,e,d)},this),this.delegateBindings()),this.listenTo(this.model,"change",function(b){var c=this.constructor.writers[f],d=a?this.$(a):this.$el,e=b.get(g);c?c.call(this,d,e):d.prop(f,e)}),this},delegateBindings:function(a){return a=a||_.result(this,"bindings"),this.undelegateBindings(),_.each(a,function(a,b){var c=b.match(/^(\S+)\s*(.*)$/),d=c[1]+".delegateBindings."+this.cid,e=c[2];this.$el.on(d,e,a)},this),this},undelegateBindings:function(){return this.$el.off(".delegateBindings."+this.cid),this},syncToModel:function(){var a=this.model;return a.trigger("change",a),this}},{readers:{html:function(a){return a.html()},text:function(a){return a.text()},visible:function(a){return a.is(":visible")},value:function(a){return a.val()},checked:function(a){var b,c=[];return _.each(a,function(a){a.checked&&c.push(a.value)}),b="radio"===a.prop("type")?c[0]:a.length>1?c:!!c[0]}},writers:{html:function(b,c){a(c)?b.html(c):b.empty()},text:function(b,c){a(c)?b.text(c):b.empty()},visible:function(b,c){a(c)?b.show():b.hide()},value:function(b,c){a(c)?b.val(c):b.val(null)},checked:function(a,b){var c,d=_.isArray(b)?b:[b];d=_.map(d,function(a){return String(a)}),c=a.filter(function(){return _.contains(d,this.value)}),"radio"===a.prop("type")?c.prop("checked",!0):a.length>1?(a.not(c).filter(":checked").prop("checked",!1),c.not(":checked").prop("checked",!0)):a.prop("checked",b)}}})}(),function(){"use strict";var a=Backbone.View;Backbone.ViewCollection=a.extend({view:Backbone.ViewModel,constructor:function(b){this.views=[],this.initialize=_.wrap(this.initialize,function(a,b){var c=this.collection;return this.listenTo(c,"reset",this.syncToCollection),this.listenTo(c,"sort",this._sortViews),this.listenTo(c,"add",this._addView),this.listenTo(c,"remove",this._removeView),c.isEmpty()||this.syncToCollection(),a.call(this,b)}),a.call(this,b)},remove:_.wrap(a.prototype.remove,function(a){return this._destroyViews(),a.call(this)}),get:function(a){var b=a.id||a,c=a.cid||a;return _.find(this.views,function(a){var d=a.model;return d.id===b||d.cid===c})},at:function(a){return this.views[a]},syncToCollection:function(){return this._refreshViews({reset:!0}),this},_sortViews:function(a){var b=this.views,c=a.comparator;c&&(_.isString(c)?this.views=_.sortBy(b,function(a){return a.model[c]}):1===c.length?this.views=_.sortBy(b,function(b){return c.call(a,b.model)}):b.sort(function(b,d){return c.call(a,b.model,d.model)}),this._refreshViews())},_addView:function(a){var b=this.views,c=this._ensureContainer(a),d=this.get(a)||this._prepareView(a),e=_.indexOf(b,d);-1===e&&b.push(d),d.$el.appendTo(c)},_removeView:function(a){var b=this.views,c=this.get(a),d=_.indexOf(b,c);-1!==d&&b.splice(d,1),c.remove()},_prepareView:function(a){var b=this.view,c=new b({model:a});return c.render()},_ensureContainer:function(a){var b=this.container;return _.isFunction(b)&&(b=b.call(this,a)),b?this.$(b):this.$el},_refreshViews:function(a){a=a||{},a.reset?this._destroyViews():this._detachViews(),this.collection.each(this._addView,this)},_destroyViews:function(){for(var a=this.views;a.length>0;)this._removeView(a[0].model)},_detachViews:function(){var a=this.views;_.each(a,function(a){a.$el.detach()})}})}();