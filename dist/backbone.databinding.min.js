/**
 * Backbone.DataBinding v0.4.3
 * https://github.com/DreamTheater/Backbone.DataBinding
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
!function(){"use strict";var a,b=Backbone.ModelBinder=function(c,d){return this instanceof b?(a=_.extend(this,{view:c,model:d},{handlers:{}}),_.extend(c,{setElement:_.wrap(c.setElement,function(b,c,d){return this.$el&&a.undelegateEvents(),b.call(this,c,d),d!==!1&&a.delegateEvents(),this})}),void 0):new b(c,d)};_.extend(b,{handlers:{html:{getter:function(){return this.html()},setter:function(a){a=_.isNull(a)||_.isUndefined(a)?"":String(a),this.html(a)}},text:{getter:function(){return this.text()},setter:function(a){a=_.isNull(a)||_.isUndefined(a)?"":String(a),this.text(a)}},value:{getter:function(){var a=this.val()||[];return this.is("select[multiple]")?a:String(a)},setter:function(a){a=_.isArray(a)?_.reject(a,function(a){return _.isNull(a)||_.isUndefined(a)}):_.isNull(a)||_.isUndefined(a)?[]:String(a),this.val(a)}},checked:{getter:function(){var a,b=_.chain(this).filter(function(a){return a.checked}).pluck("value").value();return a="radio"===this.prop("type")?b[0]:"on"===this.prop("value")?!!b[0]:b},setter:function(a){var b=_.isArray(a)?a:[String(a)];b=_.reject(b,function(a){return _.isNull(a)||_.isUndefined(a)}),"radio"===this.prop("type")?this.val(b):"on"===this.prop("value")?this.prop("checked",a):this.val(b)}},visible:{getter:function(){return this.is(":visible")},setter:function(a){this.prop("hidden",!a)}},hidden:{getter:function(){return this.is(":hidden")},setter:function(a){this.prop("hidden",a)}},enabled:{getter:function(){return this.is(":enabled")},setter:function(a){this.prop("disabled",!a)}},disabled:{getter:function(){return this.is(":disabled")},setter:function(a){this.prop("disabled",a)}}}}),_.extend(b.prototype,{constructor:b,watch:function(a,b){var c;return!a||_.isObject(a)?c=a:(c={})[a]=b,_.each(c,function(a,b){a=a||{},this._addHandlers(b,a)},this),this.refresh(),this},refresh:function(){var a=_.pluck(this.handlers,"setter");return _.each(a,function(a){a&&a()}),this},delegateEvents:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){var c=this._resolveEvents.call({view:this.view,options:a},b),d=a.selector,e=a.getter;this.undelegateEvents(b),e&&this.view.$el.on(c,d,e)},this),this},undelegateEvents:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){var c=this._resolveEvents.call({view:this.view,options:a},b),d=a.selector,e=a.getter;e&&this.view.$el.off(c,d,e)},this),this},startListening:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){var c=a.setter;this.stopListening(b),c&&this.view.listenTo(this.model,"change",c)},this),this},stopListening:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a){var b=a.setter;b&&this.view.stopListening(this.model,"change",b)},this),this},_addHandlers:function(a,b){var c=a.match(/^\s*([-\w]+)\s*:\s*([-\w]+)\s*$/),d=c[1],e=c[2],f=this.constructor.handlers[d]||{};this.undelegateEvents(a).stopListening(a),this.handlers[a]=_.defaults(b,{getter:_.wrap(f.getter,function(a){var c=this._resolveElement.call({view:this.view,options:b}),f=a?a.call(c):c.attr(d);return this.model.set(e,f,b)}),setter:_.wrap(f.setter,function(a){var c=this._resolveElement.call({view:this.view,options:b}),f=this.model.get(e);return a?a.call(c,f):c.attr(d,f)})}),this._bindCallbacks(b),this.delegateEvents(a).startListening(a)},_bindCallbacks:function(a){var b=a.getter,c=a.setter;b&&(a.getter=_.bind(b,this)),c&&(a.setter=_.bind(c,this))},_resolveElement:function(){var a=this.options.selector,b=this.view;return _.isFunction(a)&&(a=a.call(b)),a?b.$(a):b.$el},_resolveEvents:function(a){var b=this.options.event||"change",c=b.match(/\S+/g);return c=_.map(c,function(b){return b+"."+a+".modelBinder."+this.view.cid},this),c.join(" ")}})}(),function(){"use strict";var a,b=Backbone.CollectionBinder=function(c,d,e){return this instanceof b?(a=_.extend(this,{view:c,collection:d,options:e},{views:[]}),_.extend(c,{remove:_.wrap(c.remove,function(b){return a.removeViews().removeDummy(),b.call(this),this})}),void 0):new b(c,d,e)};_.extend(b,{handlers:{add:function(a){var b=this.views,c=this._resolveView(a)||this._prepareView(a),d=_.indexOf(b,c);if(-1===d&&b.push(c),0===c.$el.parent().length){var e=this._resolveElement.call({view:this.view,options:this.options},a);c.$el.appendTo(e)}},remove:function(a){var b=this.views,c=this._resolveView(a),d=_.indexOf(b,c);-1!==d&&b.splice(d,1),c&&c.remove()},reset:function(a){this.removeViews().renderViews(a)},sort:function(a){var b=this.views,c=a.comparator;c&&(_.isString(c)?this.views=_.sortBy(b,function(a){return a.model.get(c)}):1===c.length?this.views=_.sortBy(b,function(b){return c.call(a,b.model)}):b.sort(function(b,d){return c.call(a,b.model,d.model)}),this.detachViews().renderViews(a))}}}),_.extend(b.prototype,{constructor:b,listen:function(a){return a=a||{},this._addHandlers(a),this.refresh(),this},refresh:function(){var a=this.handlers.reset;return a&&a(this.collection),this},renderViews:function(a){return a.each(this.constructor.handlers.add,this),this},removeViews:function(){for(var a=this.views;a.length>0;)this.constructor.handlers.remove.call(this,a[0].model);return this},detachViews:function(){var a=this.views;return _.each(a,function(a){a.$el.detach()}),this},renderDummy:function(){var a=this.dummy||this._prepareDummy();if(a&&(this.dummy=a,0===a.$el.parent().length)){var b=this._resolveElement.call({view:this.view,options:this.options});a.$el.appendTo(b)}return this},removeDummy:function(){var a=this.dummy;return delete this.dummy,a&&a.remove(),this},detachDummy:function(){var a=this.dummy;return a&&a.$el.detach(),this},startListening:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){this.stopListening(b),a&&this.view.listenTo(this.collection,b,a)},this),this},stopListening:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){a&&this.view.stopListening(this.collection,b,a)},this),this},_addHandlers:function(a){var b=this.constructor.handlers;this.stopListening(),this.handlers=_.defaults(a,{add:_.wrap(b.add,function(a,b){this.detachDummy(),a.call(this,b)}),remove:_.wrap(b.remove,function(a,b){a.call(this,b),this.collection.isEmpty()&&this.renderDummy()}),reset:_.wrap(b.reset,function(a,b){this.removeDummy(),a.call(this,b),this.collection.isEmpty()&&this.renderDummy()}),sort:_.wrap(b.sort,function(a,b){a.call(this,b)})}),this._bindCallbacks(a),this.startListening()},_bindCallbacks:function(a){var b=a.add,c=a.remove,d=a.reset,e=a.sort;b&&(a.add=_.bind(b,this)),c&&(a.remove=_.bind(c,this)),d&&(a.reset=_.bind(d,this)),e&&(a.sort=_.bind(e,this))},_resolveElement:function(a){var b=this.options.selector,c=this.view;return _.isFunction(b)&&(b=b.call(c,a)),b?c.$(b):c.$el},_resolveView:function(a){var b=this.views;return _.find(b,function(b){return b.model===a})},_prepareView:function(a){var b,c=this.options.view;try{b=new c({model:a})}catch(d){throw d}return b.render()},_prepareDummy:function(){var a,b=this.options.dummy;try{a=new b}catch(c){return}return a.render()}})}();