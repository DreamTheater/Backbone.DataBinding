/*!
 * Backbone.DataBinding v0.1.7
 * https://github.com/DreamTheater/Backbone.DataBinding
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
Backbone.ViewModel=function(e){"use strict";return e.extend({constructor:function(){this.bindings={},e.apply(this,arguments);var t=this.model;t.collection&&this.listenTo(t,"remove",function(){this.remove()})},remove:_.wrap(e.prototype.remove,function(e){var t,i,n=this.container;return n&&(t=n.views,i=_.indexOf(t,this),t.splice(i,1)),e.call(this)}),setElement:_.wrap(e.prototype.setElement,function(e,t,i){return this.$el&&this.undelegateBindings(),e.call(this,t,i),this.delegateBindings(),this}),binding:function(e,t,i,n){var s=i.split(":"),r=s[0],o=s[1];return e&&(this.bindings[e+" "+t]=_.bind(function(){var e=this.constructor.readers,i=e[r],s=this.$(t),c=i?i.call(e,s):s.prop(r);this.model.set(o,c,n)},this),this.delegateBindings()),this.listenTo(this.model,"change",function(e){var i=this.constructor.writers,n=i[r],s=this.$(t),c=e.get(o);n?n.call(i,s,c):s.prop(r,c)}),this.syncToModel(),this},delegateBindings:function(e){return e=e||_.result(this,"bindings"),this.undelegateBindings(),_.each(e,function(e,t){var i=t.match(/^(\S+)\s*(.*)$/),n=i[1]+".delegateBindings."+this.cid,s=i[2];this.$el.on(n,s,e)},this),this},undelegateBindings:function(){return this.$el.off(".delegateBindings."+this.cid),this},syncToModel:function(){var e=this.model;return e.trigger("change",e),this}},{readers:{html:function(e){return e.html()},text:function(e){return e.text()},value:function(e){return e.val()},checked:function(e){var t,i=_.pluck(e.serializeArray(),"value");return t="radio"===e.prop("type")?i[0]:e.length>1?i:!!i[0]}},writers:{html:function(e,t){t?e.html(t):e.empty()},text:function(e,t){t?e.text(t):e.empty()},value:function(e,t){t?e.val(t):e.val(null)},checked:function(e,t){var i=_.isArray(t)?t:[t],n=e.filter(function(){return _.contains(i,this.value)});"radio"===e.prop("type")?n.prop("checked",!0):e.length>1?(e.not(n).filter(":checked").prop("checked",!1),n.not(":checked").prop("checked",!0)):e.prop("checked",t)}}})}(Backbone.View),Backbone.ViewCollection=function(e){"use strict";return e.extend({view:Backbone.ViewModel,constructor:function(){this.views=[],e.apply(this,arguments);var t=this.collection;this.listenTo(t,"add",this._addView),this.listenTo(t,"reset",this._resetViews),this.listenTo(t,"sort",this._sortViews),this._resetViews(t)},remove:_.wrap(e.prototype.remove,function(e){return this._removeViews(),e.call(this)}),get:function(e){var t=e.id||e,i=e.cid||e;return _.find(this.views,function(e){var n=e.model;return n.id===t||n.cid===i})},at:function(e){return this.views[e]},_addView:function(e){var t=this.get(e)||this._prepareView(e);this.$el.append(t.el)},_resetViews:function(e){this._removeViews(),e.each(this._addView,this)},_sortViews:function(e){this.$el.empty(),e.each(this._addView,this)},_prepareView:function(e){var t=this.view,i=new t({model:e});return i.container=this,this.views.push(i),i.render()},_removeViews:function(){for(var e=this.views;e.length>0;)e[0].remove()}})}(Backbone.View);