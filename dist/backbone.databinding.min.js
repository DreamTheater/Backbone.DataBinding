/**
 * Backbone.DataBinding v0.2.3
 * https://github.com/DreamTheater/Backbone.DataBinding
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";var e=Backbone.View;Backbone.ViewModel=e.extend({constructor:function(t){this.initialize=_.wrap(this.initialize,function(e,t){return this.bindings={},e.call(this,t)}),e.call(this,t)},setElement:_.wrap(e.prototype.setElement,function(e,t,i){return this.$el&&this.undelegateBindings(),e.call(this,t,i),i!==!1&&this.delegateBindings(),this}),binding:function(e,t,i,n){var s=i.match(/^(\S+):(\S+)$/),r=s[1],o=s[2];return e&&(this.bindings[e+" "+t]=_.bind(function(){var e=this.constructor.readers,i=e[r],s=this.$(t),c=i?i.call(e,s):s.prop(r);this.model.set(o,c,n)},this),this.delegateBindings()),this.listenTo(this.model,"change",function(e){var i=this.constructor.writers,n=i[r],s=this.$(t),c=e.get(o);n?n.call(i,s,c):s.prop(r,c)}),this.syncToModel(),this},delegateBindings:function(e){return e=e||_.result(this,"bindings"),this.undelegateBindings(),_.each(e,function(e,t){var i=t.match(/^(\S+)\s*(.*)$/),n=i[1]+".delegateBindings."+this.cid,s=i[2];this.$el.on(n,s,e)},this),this},undelegateBindings:function(){return this.$el.off(".delegateBindings."+this.cid),this},syncToModel:function(){var e=this.model;return e.trigger("change",e),this}},{readers:{html:function(e){return e.html()},text:function(e){return e.text()},value:function(e){return e.val()},checked:function(e){var t,i=_.pluck(e.serializeArray(),"value");return t="radio"===e.prop("type")?i[0]:e.length>1?i:!!i[0]}},writers:{html:function(e,t){t?e.html(t):e.empty()},text:function(e,t){t?e.text(t):e.empty()},value:function(e,t){t?e.val(t):e.val(null)},checked:function(e,t){var i=_.isArray(t)?t:[t],n=e.filter(function(){return _.contains(i,this.value)});"radio"===e.prop("type")?n.prop("checked",!0):e.length>1?(e.not(n).filter(":checked").prop("checked",!1),n.not(":checked").prop("checked",!0)):e.prop("checked",t)}}})})(),function(){"use strict";var e=Backbone.View;Backbone.ViewCollection=e.extend({view:Backbone.ViewModel,constructor:function(t){this.initialize=_.wrap(this.initialize,function(e,t){this.views=[];var i=this.collection;return this.listenTo(i,"add",this._addView),this.listenTo(i,"remove",this._removeView),this.listenTo(i,"sort",this._sortViews),this.listenTo(i,"reset",this._resetViews),this._resetViews(i),e.call(this,t)}),e.call(this,t)},remove:_.wrap(e.prototype.remove,function(e){return this._removeViews(),e.call(this)}),get:function(e){var t=e.id||e,i=e.cid||e;return _.find(this.views,function(e){var n=e.model;return n.id===t||n.cid===i})},at:function(e){return this.views[e]},_addView:function(e){var t=this.views,i=this.get(e)||new this.view({model:e}).render(),n=_.indexOf(t,i);-1===n&&t.push(i),i.$el.appendTo(this.$el)},_removeView:function(e){var t=this.views,i=this.get(e),n=_.indexOf(t,i);t.splice(n,1),i.remove()},_sortViews:function(e){var t=this.views,i=e.comparator;_.isString(i)?this.views=_.sortBy(t,function(e){return e.model[i]}):1===i.length?this.views=_.sortBy(t,function(t){return i.call(e,t.model)}):t.sort(function(t,n){return i.call(e,t.model,n.model)}),this._refreshViews(e)},_resetViews:function(e){this._refreshViews(e,!0)},_refreshViews:function(e,t){t?this._removeViews():this._cleanViews(),e.each(this._addView,this)},_removeViews:function(){for(var e=this.views;e.length>0;)this._removeView(e[0].model)},_cleanViews:function(){this.$el.empty()}})}();