/**
 * Backbone.DataBinding v0.3.7
 * https://github.com/DreamTheater/Backbone.DataBinding
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
!function(a){"use strict";var b=Backbone.ModelBinder=function(c){return this instanceof b?(a=_.extend(this,{view:c,model:c.model},{handlers:{}}),_.extend(c,{setElement:_.wrap(c.setElement,function(b,c,d){return this.$el&&a.undelegateEvents(),b.call(this,c,d),d!==!1&&a.delegateEvents(),this})}),void 0):new b(c)};_.extend(b,{handlers:{html:{getter:function(){return this.html()},setter:function(a){_.isNull(a)||_.isUndefined(a)?this.empty():this.html(a)}},text:{getter:function(){return this.text()},setter:function(a){_.isNull(a)||_.isUndefined(a)?this.empty():this.text(a)}},value:{getter:function(){return this.val()},setter:function(a){_.isNull(a)||_.isUndefined(a)?this.val(null):this.val(a)}},checked:{getter:function(){var a,b=_.chain(this).filter(function(a){return a.checked}).pluck("value").value();return a="radio"===this.prop("type")?b[0]:"on"===this.prop("value")?!!b[0]:b},setter:function(a){var b=_.isArray(a)?a:[a];b=_.map(b,function(a){return String(a)});var c=this.filter(function(){return _.contains(b,this.value)});this.prop("checked",!1),"radio"===this.prop("type")||"on"!==this.prop("value")?c.prop("checked",!0):a&&this.prop("checked",!0)}},visible:{getter:function(){return this.is(":visible")},setter:function(a){this.prop("hidden",!a)}},hidden:{getter:function(){return this.is(":hidden")},setter:function(a){this.prop("hidden",a)}},enabled:{getter:function(){return this.is(":enabled")},setter:function(a){this.prop("disabled",!a)}},disabled:{getter:function(){return this.is(":disabled")},setter:function(a){this.prop("disabled",a)}}}}),_.extend(b.prototype,{constructor:b,define:function(a,b){var c;return!a||_.isObject(a)?c=a:(c={})[a]=b,_.each(c,function(a,b){this._addHandlers(b,a)},this),this.refresh(),this},refresh:function(){var a=_.pluck(this.handlers,"setter");return _.each(a,function(a){a&&a()}),this},startListening:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){var c=a.setter;this.stopListening(b),c&&this.view.listenTo(this.model,"change",c)},this),this},stopListening:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a){var b=a.setter;b&&this.view.stopListening(this.model,"change",b)},this),this},delegateEvents:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){var c=this.resolveEvents(b,a),d=a.selector,e=a.getter;this.undelegateEvents(b),e&&this.view.$el.on(c,d,e)},this),this},undelegateEvents:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){var c=this.resolveEvents(b,a),d=a.selector,e=a.getter;e&&this.view.$el.off(c,d,e)},this),this},resolveEvents:function(a,b){var c=b.event||"change",d=c.match(/\S+/g);return d=_.map(d,function(b){return b+"."+a+".modelBinder."+this.view.cid},this),d.join(" ")},_addHandlers:function(a,b){var c=a.match(/^\s*([-\w]+)\s*:\s*([-\w]+)\s*$/),d=c[1],e=c[2],f=b.selector,g=this.constructor.handlers[d]||{};this.undelegateEvents(a).stopListening(a),this.handlers[a]=_.defaults(b,{getter:_.wrap(g.getter,function(a){var c=f?this.$(f):this.$el,g=a?a.call(c):c.prop(d);return this.model.set(e,g,b)}),setter:_.wrap(g.setter,function(a){var b=f?this.$(f):this.$el,c=this.model.get(e);return a?a.call(b,c):b.prop(d,c)})}),this._bindCallbacks(b),this.delegateEvents(a).startListening(a)},_bindCallbacks:function(a){var b=a.getter,c=a.setter,d=this.view;b&&(a.getter=_.bind(b,d)),c&&(a.setter=_.bind(c,d))}})}(),function(a){"use strict";var b=Backbone.CollectionBinder=function(c,d){return this instanceof b?(a=_.extend(this,{view:c,collection:c.collection},{options:d},{views:[]}),_.extend(c,{remove:_.wrap(c.remove,function(b){return a.removeViews().removeDummy(),b.call(this)})},{get:function(b){var c=b.id||b,d=b.cid||b,e=a.views;return _.find(e,function(a){var b=a.model;return b.id===c||b.cid===d})},at:function(b){return a.views[b]}}),void 0):new b(c,d)};_.extend(b,{handlers:{add:function(a){var b=this.views,c=this.view.get(a)||this._prepareView(a),d=_.indexOf(b,c),e=this._ensureElement(a);-1===d&&b.push(c),c.$el.appendTo(e)},remove:function(a){var b=this.views,c=this.view.get(a),d=_.indexOf(b,c);-1!==d&&b.splice(d,1),c&&c.remove()},reset:function(a){this.removeViews().renderViews(a)},sort:function(a){var b=this.views,c=a.comparator;c&&(_.isString(c)?this.views=_.sortBy(b,function(a){return a.model[c]}):1===c.length?this.views=_.sortBy(b,function(b){return c.call(a,b.model)}):b.sort(function(b,d){return c.call(a,b.model,d.model)}),this.detachViews().renderViews(a))}}}),_.extend(b.prototype,{constructor:b,listen:function(a){return a=a||{},this._addHandlers(a),this.refresh(),this},refresh:function(){var a=_.pick(this.handlers,"reset");return _.each(a,function(a){a&&a(this.collection)},this),this},startListening:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){this.stopListening(b),a&&this.view.listenTo(this.collection,b,a)},this),this},stopListening:function(a){var b=this.handlers;return a&&(b=_.pick(b,a)),_.each(b,function(a,b){a&&this.view.stopListening(this.collection,b,a)},this),this},renderViews:function(a){return a.each(this.constructor.handlers.add,this),this},removeViews:function(){var a=this.views;return _.each(a,function(a){a.remove()}),a.splice(0),this},detachViews:function(){var a=this.views;return _.each(a,function(a){a.$el.detach()}),this},renderDummy:function(){var a,b=this.dummy;return b||(b=this._prepareView(),a=this._ensureElement(),b&&(b.$el.appendTo(a),this.dummy=b)),this},removeDummy:function(){var a=this.dummy;return a&&(a.remove(),delete this.dummy),this},_addHandlers:function(a){var b=this.constructor.handlers;this.stopListening(),this.handlers=_.defaults(a,{add:_.wrap(b.add,function(a,b){this.removeDummy(),a.call(this,b)}),remove:_.wrap(b.remove,function(a,b){a.call(this,b),this.collection.isEmpty()&&this.renderDummy()}),reset:_.wrap(b.reset,function(a,b){this.removeDummy(),a.call(this,b),this.collection.isEmpty()&&this.renderDummy()}),sort:_.wrap(b.sort,function(a,b){a.call(this,b)})}),this._bindCallbacks(a),this.startListening()},_bindCallbacks:function(a){var b=a.add,c=a.remove,d=a.reset,e=a.sort;b&&(a.add=_.bind(b,this)),c&&(a.remove=_.bind(c,this)),d&&(a.reset=_.bind(d,this)),e&&(a.sort=_.bind(e,this))},_prepareView:function(a){var b,c=this.options.view,d=this.options.dummy;return a?b=new c({model:a}):d&&(b=new d),b?b.render():null},_ensureElement:function(a){var b=this.options.selector,c=this.view;return _.isFunction(b)&&(b=b.call(c,a)),b?c.$(b):c.$el}})}();