/**
 * Backbone.DataBinding v0.2.7
 * https://github.com/DreamTheater/Backbone.DataBinding
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";var t=Backbone.View;Backbone.ViewModel=t.extend({constructor:function(e){this.initialize=_.wrap(this.initialize,function(t,e){return this.bindings={},t.call(this,e)}),t.call(this,e)},setElement:_.wrap(t.prototype.setElement,function(t,e,i){return this.$el&&this.undelegateBindings(),t.call(this,e,i),i!==!1&&this.delegateBindings(),this}),binding:function(t,e,i,n){var s=e.match(/^(\S+):(\S+)$/),r=s[1],o=s[2];return i&&(this.bindings[i+" "+t]=_.bind(function(){var e=this.constructor.readers,i=e[r],s=this.$(t),c=i?i.call(e,s):s.prop(r);this.model.set(o,c,n)},this),this.delegateBindings()),this.listenTo(this.model,"change",function(e){var i=this.constructor.writers,n=i[r],s=this.$(t),c=e.get(o);n?n.call(i,s,c):s.prop(r,c)}),this},delegateBindings:function(t){return t=t||_.result(this,"bindings"),this.undelegateBindings(),_.each(t,function(t,e){var i=e.match(/^(\S+)\s*(.*)$/),n=i[1]+".delegateBindings."+this.cid,s=i[2];this.$el.on(n,s,t)},this),this},undelegateBindings:function(){return this.$el.off(".delegateBindings."+this.cid),this},syncToModel:function(){var t=this.model;return t.trigger("change",t),this}},{readers:{html:function(t){return t.html()},text:function(t){return t.text()},value:function(t){return t.val()},checked:function(t){var e,i=_.pluck(t.serializeArray(),"value");return e="radio"===t.prop("type")?i[0]:t.length>1?i:!!i[0]}},writers:{html:function(t,e){e?t.html(e):t.empty()},text:function(t,e){e?t.text(e):t.empty()},value:function(t,e){e?t.val(e):t.val(null)},checked:function(t,e){var i=_.isArray(e)?e:[e],n=t.filter(function(){return _.contains(i,this.value)});"radio"===t.prop("type")?n.prop("checked",!0):t.length>1?(t.not(n).filter(":checked").prop("checked",!1),n.not(":checked").prop("checked",!0)):t.prop("checked",e)}}})})(),function(){"use strict";var t=Backbone.View;Backbone.ViewCollection=t.extend({view:Backbone.ViewModel,constructor:function(e){this.initialize=_.wrap(this.initialize,function(t,e){this.views=[];var i=this.collection;return this.listenTo(i,"reset",this.syncToCollection),this.listenTo(i,"sort",this._sortViews),this.listenTo(i,"add",this._addView),this.listenTo(i,"remove",this._removeView),i.length>0&&this.syncToCollection(),t.call(this,e)}),t.call(this,e)},remove:_.wrap(t.prototype.remove,function(t){return this._destroyViews(),t.call(this)}),get:function(t){var e=t.id||t,i=t.cid||t;return _.find(this.views,function(t){var n=t.model;return n.id===e||n.cid===i})},at:function(t){return this.views[t]},syncToCollection:function(){return this._refreshViews({reset:!0}),this},_sortViews:function(t){var e=this.views,i=t.comparator;i&&(_.isString(i)?this.views=_.sortBy(e,function(t){return t.model[i]}):1===i.length?this.views=_.sortBy(e,function(e){return i.call(t,e.model)}):e.sort(function(e,n){return i.call(t,e.model,n.model)}),this._refreshViews())},_addView:function(t){var e=this.views,i=this._ensureContainer(t),n=this.get(t)||this._prepareView(t),s=_.indexOf(e,n);-1===s&&e.push(n),n.$el.appendTo(i)},_removeView:function(t){var e=this.views,i=this.get(t),n=_.indexOf(e,i);-1!==n&&e.splice(n,1),i.remove()},_prepareView:function(t){var e=this.view,i=new e({model:t});return i.render()},_ensureContainer:function(t){var e=this.container;return _.isFunction(e)&&(e=e.call(this,t)),e?this.$(e):this.$el},_refreshViews:function(t){t=t||{},t.reset?this._destroyViews():this._detachViews(),this.collection.each(this._addView,this)},_destroyViews:function(){for(var t=this.views;t.length>0;)this._removeView(t[0].model)},_detachViews:function(){var t=this.views;_.each(t,function(t){t.$el.detach()})}})}();